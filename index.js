module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t){e.exports=require("xstream")},function(e,t){e.exports=require("mathjs")},function(e,t){e.exports=require("@mvarble/frames.js")},function(e,t){e.exports=require("@mvarble/viewport.js")},function(e,t){e.exports=require("unist-builder")},function(e,t){e.exports=require("xstream/extra/sampleCombine")},function(e,t){e.exports=require("xstream/extra/flattenConcurrently")},function(e,t){e.exports=require("xstream/extra/dropRepeats")},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),i=r(4),a=r.n(i),c=r(2),u=r(3),l=r(1),f=r(5),d=r.n(f),p=r(6),s=r.n(p);function y(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v=function(e,t,r){return Object.keys(e).reduce((function(n,o){return r.find((function(e){return e===o}))?b({},n,h({},o,e[o].compose(function(e){return function(t){return t.map((function(t){return{reducer:t,key:e}}))}}(t)))):b({},n,h({},o,e[o]))}),{})},O=function(e,t){return t.reduce((function(t,r){return b({},t,h({},r,o.a.merge.apply(o.a,y(e.map((function(e){return e[r]}))))))}),{})},g=function(e){return function(t){return t.map((function(t){return t[e]})).flatten()}},j=function(e){return function(t){return t.map((function(t){return t[e]})).compose(s.a)}};function w(e){var t=function(e){var t=e.key,r=e.reducer;return function(e){var n=b({},e);n.children=y(n.children);var o=n.children.findIndex((function(e){return e.key===t}));return o>=0&&(n.children[o]=r(n.children[o])),n}};return function(r){return r.compose(j(e)).map(t)}}var x=r(7),P=r.n(x);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){A(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function D(e,t,r){void 0!==r.data.linkedTo?function(e,t,r){var n=t.find((function(e){return e.key===r.data.linkedTo}));if(!n)return;e.lineWidth=3,e.strokeStyle="#AAA";var o={worldMatrix:l.identity(3)},i=Object(c.locFrameTrans)([0,0],r,o),a=Object(c.locFrameTrans)([0,0],n.children[0],o);e.beginPath(),e.moveTo.apply(e,T(i)),e.lineTo.apply(e,T(a)),e.stroke()}(e,t,r):void 0!==r.data.to&&function(e,t,r){e.lineWidth=3,e.strokeStyle="#DDD";var n={worldMatrix:l.identity(3)},o=Object(c.locFrameTrans)([0,0],r,n);e.beginPath(),e.moveTo.apply(e,T(o)),e.lineTo.apply(e,T(r.data.to)),e.stroke()}(e,0,r)}function E(e,t,r){return S({},e,{data:S({},e.data,{linkedTo:t?t.data.parentKey:void 0,to:r})})}function F(e){var t=e.children.findIndex((function(e){return"out-edge-node"===e.type&&void 0===e.data.linkedTo}));return t<0?function(e){var t=S({},e),r=t.children.length,n=Object(c.translatedFrame)(t.children[r-1],[2/(r*(r+1)),0],e);return n.data.linkedTo=void 0,n.key=l.max(e.children.map((function(e){return e.key||0})))+1,t.children=[].concat(T(e.children.map((function(t,n){return"out-edge-node"===t.type?Object(c.translatedFrame)(t,[-2*n/(r*(r+1)),0],e):t}))),[n]),t}(e):t===e.children.length-1?e:function(e,t){var r=e.children.length,n=e.children.slice(0,t).map((function(t,n){return"out-edge-node"===t.type?Object(c.translatedFrame)(t,[2*n/(r*(r-1)),0],e):t})),o=e.children.slice(t+1,e.children.length).map((function(n,o){return Object(c.translatedFrame)(n,[-2*(r-(o+t+1))/(r*(r-1)),0],e)})),i=S({},e);return i.children=[].concat(T(n),T(o)),i}(e,t)}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){K(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function N(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function W(e){var t=e.mouse,r=e.state,n=e.parent,i=o.a.combine(n,r).map((function(e){var t=_(e,2),r=t[0],n=t[1],o=r.children.filter((function(e){return e.data.selected})).length;return n.data.selected&&1===o})),a=t.singleclick.compose(d()(r)).filter((function(e){var t=_(e,2),r=t[0];t[1];return r.shiftKey})).map((function(e){var t=_(e,2),r=(t[0],t[1]);return r.data.active?{self:o.a.of(B),parent:o.a.empty()}:{self:o.a.of(Y),parent:o.a.of(V(r.key))}})),c=t.singleclick.compose(d()(r,i)).filter((function(e){var t=_(e,2),r=t[0];t[1];return!r.shiftKey})).map((function(e){var t=_(e,3),r=(t[0],t[1]),n=t[2];return r.data.active&&n?{self:o.a.of(B),parent:o.a.empty()}:{self:o.a.empty(),parent:o.a.of(X(r.key))}})),l=t.select().drag.compose(d()(r)).map((function(e){var t=_(e,2),r=t[0],n=t[1],i=r.take(1).map((function(e){return n.data.active?o.a.of(C(e)):n.data.selected||e.shiftKey?o.a.merge(o.a.of(V(n.key)),o.a.of(C(e))):o.a.merge(o.a.of(X(n.key)),o.a.of(C(e)))})).flatten(),a=r.drop(1).filter((function(e){return e.movementX&&e.movementY})).map(C);return{self:o.a.empty(),parent:o.a.merge(i,a)}})),f=r.map((function(e){var r=e.children.filter((function(e){return"out-edge-node"===e.type})).map((function(e){var r=function(e){var t=e.mouse,r=e.state,n=e.grandparent,i=t.drag.flatten().compose(d()(r,n)).map((function(e){var t=M(e,3),r=t[0],n=t[1],o=t[2],i=Object(u.getOver)(r,o);return i&&"in-edge-node"===i.type&&i.data.parentKey!==n.data.parentKey?{hoveredNode:i,event:r}:{position:Object(u.relativeMousePosition)(r),event:r}})).compose(P()((function(e,t){return e.hoveredNode&&t.hoveredNode&&e.event.type===t.event.type}))).map((function(e){var t=e.event,r=e.hoveredNode,n=e.position;return"mousemove"===t.type?{self:o.a.of((function(e){return E(e,r,n)})),parent:o.a.empty()}:{self:o.a.of((function(e){var t=E(e,r,n);return t.data.to=void 0,t})),parent:o.a.of(F)}}));return{self:i.compose(g("self")),parent:i.compose(g("parent"))}}({mouse:t.select(e.key),state:o.a.of(e),grandparent:n});return v(r,e.key,["self"])}));return O(r,["self","parent"])}));return{self:o.a.merge(a.compose(g("self")),c.compose(g("self")),l.compose(g("self")),f.compose(w("self")),f.compose(j("parent"))),parent:o.a.merge(a.compose(g("parent")),c.compose(g("parent")),l.compose(g("parent")))}}function Y(e){var t=q({},e);return t.data.selected=!0,t.data.active=!0,t}function B(e){var t=q({},e);return t.data.selected=!1,t.data.active=!1,t}function G(e){return function(t){var r=t.children.findIndex((function(t){return t.key===e}));if(r>=0){var n=q({},t);return n.children=[t.children[r]].concat(N(t.children.slice(0,r)),N(t.children.slice(r+1,t.children.length))),n}return t}}function V(e){return function(t){var r=G(e)(t),n=r.children.length;return n&&r.children[0].key===e&&(r.children=[Y(r.children[0])].concat(N(r.children.slice(1,n).map((function(e){return q({},e,{data:q({},e.data,{active:!1})})}))))),r}}function X(e){return function(t){var r=G(e)(t),n=r.children.length;return n&&r.children[0].key===e&&(r.children=[Y(r.children[0])].concat(N(r.children.slice(1,n).map(B)))),r}}function C(e){var t=e.movementX,r=e.movementY;return function(e){var n=q({},e);return n.children=n.children.map((function(e){return e.data.selected?function(e,t,r){return Object(c.translatedFrame)(e,[t,r],{worldMatrix:l.identity(3)})}(e,t,r):e})),n}}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function L(e){var t=e.mouse,r=e.state,n=t.wheel.map((function(e){return function(t){return function(e,t){var r=e.deltaY,n=l.sqrt(l.norm(Object(c.vecFrameTrans)([1,1],t,{worldMatrix:l.identity(3)})));if(n<5&&r>0)return t;if(n>10&&r<0)return t;var o=Object(u.relativeMousePosition)(e),i={worldMatrix:l.matrix([[1,0,o[0]],[0,-1,o[1]],[0,0,1]])};return Object(c.scaledFrame)(t,l.multiply(l.pow(1.1,-r),[1,1]),i)}(e,t)}})),i=t.select().drag.flatten().filter((function(e){return e.movementX&&e.movementY})).map((function(e){return function(t){return r=t,n=e.movementX,o=e.movementY,(i=Object(c.translatedFrame)(r,[n,o],{worldMatrix:l.identity(3)})).children=i.children.map(B),i;var r,n,o,i}})),a=t.select().singleclick.mapTo(Q),f=r.map((function(e){var n=e.children.map((function(n){var i=W({mouse:Object(u.FilteredMouse)({mouse:Object(u.KilledMouse)({mouse:t.select(n.key),end:r.drop(1)}),node:o.a.of(n)}),state:o.a.of(n),parent:o.a.of(e)});return v(i,n.key,["self"])}));return O(n,["self","parent"])}));return{state:o.a.merge(n,i,a,f.compose(w("self")),f.compose(j("parent")))}}function Q(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){z(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e);return t.children=e.children.map(B),t}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){$(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ee(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r.d(t,"GraphViewport",(function(){return te})),r.d(t,"renderGraphViewport",(function(){return re})),r.d(t,"deleteSelectedNodes",(function(){return oe})),r.d(t,"appendNode",(function(){return ie}));t.default={GraphViewport:te,renderGraphViewport:re,deleteSelectedNodes:oe,appendNode:ie};function te(e){var t=e.canvas,r=e.props,n=e.state,i=e.viewport,c=Object(u.MouseObject)(t),l=r.map((function(e){return function(){return e.initState}})),f=i.resize.map((function(e){var t=e.dims;return function(e){return ne.apply(void 0,[e].concat(ee(t)))}})),d=n.stream.map((function(e){return e.children[0].children[0]})),p=L({mouse:Object(u.FilteredMouse)({mouse:c,node:d}),state:d}).state.map((function(e){return function(t){return a()("root",{id:t.id,width:t.width,height:t.height},[Z({},t.children[0],{children:[e(t.children[0].children[0])]})])}}));return{state:o.a.merge(l,f,p),viewport:n.stream,preventDefault:c.wheel}}function re(e,t){var r=t.children[0],n=r.children[0],o=n.children,i=e.getContext("2d");i.fillStyle="#666",i.clearRect(0,0,t.width,t.height),i.beginPath(),i.fillRect(0,0,t.width,t.height),function(e,t,r){e.strokeStyle="#555",e.lineWidth=1;var n=J(Object(c.locsFrameTrans)([[-1,-1],[1,1]],t,r),2),o=n[0],i=n[1],a=J(l.floor(o),2),u=a[0],f=a[1],d=J(l.ceil(i),2),p=2*(d[0]-u+1),s=2*(d[1]-f+1),y={worldMatrix:l.identity(3)},m=Object(c.locFrameTrans)([u,f],r,y),b=J(Object(c.vecsFrameTrans)([[.5,0],[0,.5]],r,y),2),h=b[0],v=b[1],O=J(Object(c.vecsFrameTrans)([[3,0],[0,3]],t,y),2),g=O[0],j=O[1];e.beginPath(),H(Array(p).keys()).forEach((function(t,r){var n=l.add(m,l.multiply(r,h));e.moveTo.apply(e,H(n)),e.lineTo.apply(e,H(l.add(n,j)))})),H(Array(s).keys()).forEach((function(t,r){var n=l.add(m,l.multiply(r,v));e.moveTo.apply(e,H(n)),e.lineTo.apply(e,H(l.add(n,g)))})),e.stroke()}(i,r,n),o.forEach((function(e){e.children.forEach((function(e){"out-edge-node"===e.type&&D(i,o,e)}))})),ee(o).reverse().forEach((function(e){!function(e,t){e.lineWidth=1,e.strokeStyle=t.data.active?"yellow":t.data.selected?"#cc7f19":"black",e.fillStyle="rgba(255, 255, 255, 0.8)";var r=Object(c.locsFrameTrans)([[-1,1],[1,-1]],t,{worldMatrix:l.identity(3)}),n=l.subtract(r[1],r[0]);if(e.beginPath(),e.rect.apply(e,N(r[0]).concat(N(n))),e.fill(),e.stroke(),N(t.children).reverse().forEach((function(t){return function(e,t){var r=t.worldMatrix.valueOf(),n=r[0][0],o=[r[0][2]-n,r[1][2]-n];e.fillStyle="in-edge-node"===t.type?"rgba(255, 200, 0, 1)":"rgba(0, 255, 200, 1)",e.beginPath(),e.rect.apply(e,o.concat([2*n,2*n])),e.fill(),e.stroke()}(e,t)})),t.data.title&&""!==t.data.title){var o=Object(c.vecFrameTrans)([.2,0],t,{worldMatrix:l.identity(3)})[0],i=l.multiply(.5,l.add.apply(l,N(r).concat([[0,.5*o]])));e.font="".concat(o,"px Arial"),e.fillStyle="black",e.textAlign="center",e.fillText.apply(e,[t.data.title].concat(N(i)))}}(i,e)}))}function ne(e,t,r){var n=Object(c.withWorldMatrix)(e.children[0],l.matrix([[t/2,0,t/2],[0,-r/2,r/2],[0,0,1]])),o=n.children[0].worldMatrix.valueOf(),i=Object(c.scaledFrame)(n.children[0],[-o[1][1]/o[0][0],1],{worldMatrix:l.matrix([[1,0,t/2],[0,-1,r/2],[0,0,1]])});return a()("root",{id:e.id,width:t,height:r},[Z({},n,{children:[i]})])}function oe(e){var t=e.children[0],r=t.children[0];return r.children=r.children.filter((function(e){return e.data.selected})),a()("root",$({id:e.id,width:e.width},"width",height),[Z({},t,{children:[r]})])}function ie(e){var t=e.children[0],r=t.children[0],n=t.worldMatrix.valueOf(),o=r.worldMatrix.valueOf(),i=r.children.length?l.max(r.children.map((function(e){return e.key})))+1:0,c={worldMatrix:l.matrix([[2.5*o[0][0],0,n[0][2]],[0,o[1][1],n[1][2]],[0,0,1]]),key:i,data:{clickBox:[-1,-1,1,1],selected:!0,active:!0,title:""}},u={worldMatrix:l.matrix([[.1*o[0][0],0,n[0][2]],[0,.1*o[1][1],n[1][2]+.9*o[1][1]],[0,0,1]]),data:{clickBox:[-4,-4,4,1],parentKey:i}},f={worldMatrix:l.matrix([[.1*o[0][0],0,n[0][2]],[0,.1*o[1][1],n[1][2]-.9*o[1][1]],[0,0,1]]),key:0,data:{clickBox:[-4,-1,4,4],parentKey:i}},d=a()("graph-node",c,[a()("in-edge-node",u),a()("out-edge-node",f)]);return r.children=[d].concat(ee(r.children.map(deselectBox))),a()("root",{id:e.id,width:e.width,height:e.height},[Z({},t,{children:[r]})])}}]);